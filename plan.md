<!--
ASCII PRELUDE (tooling workaround):
This comment exists to keep the first ~200 bytes ASCII-only so the Windows sandbox
doesn't crash when truncating log output mid-UTF8 character. Safe to delete later.
-->

# 并发编程学习流程（基于本仓库 + Codex + JDK 21）

这份 `plan.md` 的目标：让你完成“每一章”时，清楚知道 **读前 / 阅读中 / 读后** 要做什么，并且能自测、能复盘、能落地选型。

## 总原则（先记住这 4 条）

1. 闭卷优先：先从“自己脑子里”写出来，再翻正文/问 Codex（避免“看懂错觉”）。
2. 只记错与边界：笔记不做长篇摘抄，重点记录错误、边界、模板与选型。
3. 只做可验证结论：每个结论尽量有一个最小实验/可观察输出支撑。
4. 间隔重复：错题按 `D+1 / D+3 / D+7` 复测（只测错题）。

## 一次性准备（第 0 章）

- [ ] 确认 JDK 21：`java -version`
- [ ] 跑通一个实验（示例）：

```powershell
cd labs\01-concurrency-pros-cons
javac *.java
java ConcurrencyBenefits
```

- [ ] 确认目录约定：
  - 章节原文：`01.*`、`02.*`…（每章通常 1 个主文档 `*.md`）
  - 实验：`labs/NN-xxx/`（优先看该目录 `README.md`）
  - 笔记：`notes/NN.<标题>.md`
  - 题库：`notes/questions.md`（只放题，不放答案）
- [ ] 定节奏：每章 60–120 分钟；每周留 1 次“清算错题/暂存问题”。

## 每章完成定义（Definition of Done）

完成一章，至少满足：

- [ ] 我能口述：5 个关键词 + 3 条结论 + 2 个边界/反例（不背定义，讲机制/代价）
- [ ] 我能闭卷自测：首轮 5 题 ≥ 8/10（必要时做满 10 题）
- [ ] 我至少跑过 1 个实验：含参数/校验/耗时/结论
- [ ] 我写完一页纸复盘：含错题复盘 + 下次复测安排
- [ ] 我把题目入库：`notes/questions.md` 只追加题干（不写答案）

## 每章 SOP（读前 / 阅读中 / 读后）

建议你每章先在 `notes/NN.<标题>.md` 建一个“章节作业单”，按下面 checklist 打勾。

### A. 读前（5–10 分钟）

- [ ] 定位材料：章节原文 `NN.<标题>/*.md`；对应实验 `labs/NN-*`（如果存在）
- [ ] 创建本章笔记：`notes/NN.<标题>.md`（复制文末模板，先填日期/路径/用时）
- [ ] 写下本章目标（1–2 句）：我这一章要“能回答什么问题/解决什么场景”
- [ ] 读前导航（可选，≤2 分钟）：只扫小节标题，列出 3–5 个你最不确定的问题（写进“疑点清单”）

### B. 阅读中（20–40 分钟）

- [ ] 每个小节结束用 1 句总结（写进笔记的“机制链路/结论草稿”）
- [ ] 遇到关键字统一用“保证/不保证”写法（例：`volatile` 保证可见性，不保证复合操作原子性）
- [ ] 把“看懂了”变成“能问出来”：每节至少产出 1 个可测问题（先写题干，不写答案）
- [ ] 标注 3 类内容：①机制（怎么发生）②边界（什么时候不成立）③工程信号（怎么排查/怎么选型）
- [ ] 卡住 > 3 分钟就暂存：`[暂存][P1/P2][前置: ...][下次回看: ...]`（别在正文里死磕）

### C. 读后（40–70 分钟）

按顺序做，避免“看完就觉得懂”：

#### C1. 闭卷复述（5–10 分钟）

- [ ] 不看正文，写：关键词 5–10 个、结论 3 条、误区/坑 2 条、项目落地 1 句
- [ ] 写一条“机制链路”：触发条件 → 状态/字段 → 分支 → 效果 → 边界

#### C2. 自测（20–30 分钟）

- [ ] 准备 10 题（建议：场景选型 ≥3；概念/机制/代码推理均衡）
- [ ] 首轮只做 5 题（闭卷计时），按 `0/1/2` 评分：
  - 0：关键结论错 / 答非所问
  - 1：结论对但理由/边界缺失
  - 2：结论对 + 讲清原因 + 给出边界/代价
- [ ] 首轮 ≥ 8/10：再做剩余 5 题；否则进入“错题补救”
- [ ] 自测结束后才允许看“常见误区/总结”（避免提前被喂答案）

#### C3. 错题补救（10–20 分钟，仅未达标时做）

- [ ] 每道错题只记录 3 件事（写进本章笔记的“错题与复测”区）：
  1) 漏点清单（3–5 条）
  2) 一句话正确结论
  3) 触发条件/边界/反例（至少 1 个）
- [ ] 把题目本身写入 `notes/questions.md`（只写题干，不写答案）
- [ ] 安排复测：`D+1 / D+3 / D+7`（复测只做错题）

#### C4. 实验（MRE）（15–30 分钟）

- [ ] 优先跑现成实验：先看 `labs/NN-xxx/README.md`（照着跑，记录观察点）
- [ ] 没有实验就写一个最小实验：只验证 1 个结论；输出必须包含参数/校验/耗时
- [ ] 在笔记里写清：我能推出什么 / 不能推出什么（防止过度归因）

实验统一命令（示例）：

```powershell
cd labs\NN-xxx
javac *.java
java MainClass
```

#### C5. 收尾（2–5 分钟）

- [ ] 更新“我会怎么用在项目里”（把选型写成一句话：场景-工具-代价）
- [ ] 清算暂存区：只挑 1–2 个 P1 给出下一步（对照哪章/写哪个实验/查哪个源码点）

## 题库与复测（怎么测得更准）

### `notes/questions.md` 的维护规则

- 只放题，不放答案；按章节前缀编号：`CHNN-Qxx`
- 每章建议 10–20 题：其中场景题 ≥ 30%
- 每周至少做一次“错题复测”：只测错题 + 重新口述机制链路

示例格式：

```md
# 第 14 章（CH14）
- CH14-Q01 [场景] ConcurrentHashMap 适合什么读写比例？为什么？
- CH14-Q02 [机制] JDK8 CHM 的 put 流程关键分支是什么？
```

### 复测节奏（默认）

- D+1：只做错题（闭卷）
- D+3：只做错题（闭卷）+ 追加 1 道场景题
- D+7：只做错题（闭卷）+ 把整章 3 条结论口述一遍

## 笔记（怎么记得更“能用”）

- 一页纸只写 5 类内容：关键词 / 机制链路 / 结论+边界 / 误区+模板 / 选型一句话
- 避免两件事：大段摘抄、把 Codex 输出原封不动粘贴
- 每个“工具/关键字”至少留一个“正确用法模板”（例如 while-await-signal）

## 推荐进度（按模块拆，不强行按周）

- 模块A：01–03 基础与 JMM
- 模块B：04–07 synchronized/volatile/final 与三大性质
- 模块C：08–13 Lock 体系与 AQS
- 模块D：14–20 并发容器与 ThreadLocal/BlockingQueue
- 模块E：21–27 线程池/原子类/同步工具
- 模块F（可选/进阶）：28–32 虚拟线程 / Flow / VarHandle / CompletableFuture / Reactor

## 模板：每章笔记（复制即用）

```md
# 第 NN 章：<标题>

> 日期：YYYY-MM-DD
> 用时（分钟）：读前__ / 阅读__ / 自测__ / 实验__ / 复盘__
> 章节原文：`NN.<标题>/<章节主文档>.md`
> 配套实验：`labs/NN-xxx/`（如果有）
> 题库前缀：`CHNN-`

## 0) 本章目标（1–2 句）
- 

## 1) 章节作业单（照着打勾）

### 读前
- [ ] 定位章节原文与实验目录
- [ ] 创建笔记并写本章目标
- [ ] （可选）读前导航：列出 3–5 个不确定问题

### 阅读中
- [ ] 每小节 1 句总结
- [ ] 记录“保证/不保证”
- [ ] 产出可测问题（先题干不答案）
- [ ] 标注机制/边界/工程信号
- [ ] 卡住就暂存（带P1/P2与回看触发点）

### 读后
- [ ] 闭卷复述：关键词/结论/误区/落地
- [ ] 自测：先做 5 题并评分
- [ ] （必要时）错题补救 + 入库 + 排复测
- [ ] 实验：跑现成/写MRE并复盘
- [ ] 收尾：更新选型一句话，清算暂存区

## 2) 关键词（5–10 个）+ “保证/不保证”
- 

## 3) 机制链路（用步骤串起来）
- 触发条件 → 状态/字段 → 关键分支 → 效果 → 边界

## 4) 结论（3 条）+ 边界/反例
- 

## 5) 误区/坑（2 条）+ 正确写法模板
- 

## 6) 场景选型（3 题，闭卷）
- 

## 7) 最小实验（MRE）复盘
- JDK：`java -version`
- 命令：
- 参数：
- 观察点：
- 结论：
- 不能推出的结论：
- 下一步：

## 8) 错题与复测（只记错题）
- CHNN-Qxx：...
  - 我当时的答案：
  - 漏点清单：
  - 一句话正确结论：
  - 边界/反例：
  - D+1：
  - D+3：
  - D+7：
```

## Codex 提示词（可选，尽量短）

- 出题（只出题不出答案）：
  - `只基于本章内容出10道自测题：场景选型>=3；每题编号CHNN-Q01...，标注题型；先不要给答案或要点。`
- 评分纠错：
  - `我下面给出闭卷答案。请按每题0/1/2评分，并指出我漏掉的关键点/边界/代价（每题最多5条）。`
- 实验复盘：
  - `这是我的代码与输出。请解释现象，并明确：我能推出什么结论/不能推出什么结论。`
- 笔记重排（不补新知识）：
  - `这是我原始笔记。请按模板重排精简：尽量保留原话，不要补充新知识；末尾列出删减/合并清单。`
